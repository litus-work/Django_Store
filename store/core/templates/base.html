<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}GadgetShop{% endblock %}</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .carousel-viewport { width: calc(18rem + 1rem); }            /* mobile: 1 карточка */
    @media (min-width: 640px) { .carousel-viewport { width: calc(2*18rem + 1*1rem); } } /* sm: 2 */
    @media (min-width: 1024px){ .carousel-viewport { width: calc(3*18rem + 2*1rem); } } /* lg: 3 */
  </style>
</head>
<body class="bg-gray-100 text-gray-900">

  <header class="bg-white shadow">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <a href="{% url 'core:product_list' %}" class="text-2xl font-bold text-gray-900 hover:text-blue-600 transition">
        GadgetShop
      </a>
    </div>
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
        <a href="{% url 'core:product_list' %}" class="text-2xl font-bold">GadgetShop</a>
        <div class="text-sm space-x-4">
            {% if user.is_authenticated %}
                <span class="text-gray-600">Привет, {{ user.username }}!</span>
                <a href="{% url 'accounts:logout_confirm' %}" class="text-blue-600 hover:underline">Выйти</a>

            {% else %}
                <a href="{% url 'accounts:login' %}" class="text-blue-600">Войти</a>

                <a href="{% url 'accounts:signup' %}" class="text-blue-600">Регистрация</a>

            {% endif %}
        </div>
        <a href="{% url 'cart:detail' %}" class="text-blue-600 hover:underline">Корзина{% if cart_count %} ({{ cart_count }}){% endif %}</a>
    </div>

  </header>

  <div class="flex max-w-6xl mx-auto px-4 py-6 gap-6">
    <aside class="w-64 shrink-0 relative z-50">
      <div class="rounded-xl bg-white shadow p-4">
        <h2 class="text-lg font-semibold mb-3">Категории</h2>
        <nav class="flex flex-col space-y-2">
          <a href="{% url 'core:product_list' %}"
             class="px-3 py-2 rounded hover:bg-gray-100 transition
                    {% if not category %}font-semibold text-blue-600 bg-gray-100{% endif %}">
            Все товары
          </a>
          {% for cat in categories %}
            <a href="{% url 'core:product_list_by_category' cat.slug %}"
               class="px-3 py-2 rounded hover:bg-gray-100 transition
                      {% if category and category.slug == cat.slug %}font-semibold text-blue-600 bg-gray-100{% endif %}">
              {{ cat.name }}
            </a>
          {% endfor %}
        </nav>
      </div>
    </aside>

    <main class="flex-1 relative z-10">

      {% block content %}{% endblock %}
    </main>
  </div>
  {% if messages %}
  <div class="max-w-6xl mx-auto px-4 mt-3 space-y-2">
    {% for message in messages %}
      <div class="px-3 py-2 rounded text-sm
                  {% if message.tags == 'error' %}bg-red-50 text-red-700
                  {% elif message.tags == 'success' %}bg-green-50 text-green-700
                  {% else %}bg-blue-50 text-blue-700{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

  <script>
    function getStep(rowEl) {
      const card = rowEl.querySelector('[data-card]');
      const gap = 16; // gap-4
      return card ? card.offsetWidth + gap : rowEl.clientWidth * 0.9;
    }
    function scrollRow(slug, dir) {
      const row = document.getElementById('row-' + slug);
      if (!row) return;
      const step = getStep(row);
      row.scrollBy({ left: dir * step, behavior: 'smooth' });
    }
    function updateArrows() {
      document.querySelectorAll('[id^="row-"]').forEach(row => {
        const wrap = row.parentElement;
        const L = wrap.querySelector('[data-left]');
        const R = wrap.querySelector('[data-right]');
        const overflow = row.scrollWidth > row.clientWidth + 2;
        if (overflow) { L?.classList.remove('hidden'); R?.classList.remove('hidden'); }
        else { L?.classList.add('hidden'); R?.classList.add('hidden'); }
      });
    }
    window.addEventListener('load', updateArrows);
    window.addEventListener('resize', updateArrows);
  </script>
</body>
</html>
